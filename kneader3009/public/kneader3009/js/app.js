(()=>{"use strict";var t={772:(t,e,s)=>{var o=s(751),a=s(641);const n=s.p+"img/SPP_logo_website.png",r={id:"app"};function i(t,e,s,o,i,c){const l=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)("div",r,[e[0]||(e[0]=(0,a.Lk)("header",{class:"app-header"},[(0,a.Lk)("div",{class:"header-content"},[(0,a.Lk)("img",{src:n,alt:"SPP Logo",class:"company-logo"}),(0,a.Lk)("h1",{class:"app-title"},"Kneader Controller System")])],-1)),(0,a.Lk)("main",null,[(0,a.bF)(l)])])}const c={name:"App"};var l=s(262);const u=(0,l.A)(c,[["render",i]]),h=u;var p=s(220),d=s(33);const m={class:"dashboard"},g={key:0,class:"login-container"},b={class:"login-card"},k={class:"login-form"},_={class:"input-group"},w={class:"input-group"},y={class:"password-input-container"},f=["type"],I={key:0,class:"toggle-text"},S={key:1,class:"toggle-text"},C={class:"button-container"},P=["disabled"],v={key:0,class:"error-message"},E={class:"error-text"},L={key:1},T={key:0,class:"batch-panel"},N={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"1rem"}},x={style:{display:"flex",gap:"20px","justify-content":"center","margin-top":"1rem"}},A={key:1,class:"batch-panel"},B={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"1rem"}},R={style:{margin:"0"}},O={class:"batch-input",style:{display:"flex",gap:"8px","align-items":"center"}},D={key:2,class:"confirmation-dialog"},M={class:"dialog-content"},X={style:{display:"flex",gap:"10px","justify-content":"center","margin-top":"1rem"}},W={key:3,class:"prescan-panel"},$={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"1rem"}},F={style:{margin:"0"}},G=["disabled"],j={key:0,class:"confirmation-dialog"},U={class:"dialog-content"},Q={style:{display:"flex",gap:"10px","justify-content":"center","margin-top":"1rem"}},K={class:"status-line"},Y={class:"prescan-table"},q=["rowspan"],V=["rowspan"],J={key:0},z={key:1},H={key:0,style:{color:"green"}},Z={key:1},tt={key:3},et={key:0,style:{color:"orange","font-weight":"bold"}},st={key:1,style:{color:"blue"}},ot={key:2,style:{color:"orange","font-weight":"bold"}},at={key:3,style:{color:"green","font-weight":"bold"}},nt={key:4,style:{color:"red","font-weight":"bold"}},rt={key:5,style:{color:"gray","font-weight":"bold"}},it={key:6},ct={key:0,style:{color:"green"}},lt={key:1},ut={key:3},ht={key:0,style:{color:"orange","font-weight":"bold"}},pt={key:1,style:{color:"blue"}},dt={key:2,style:{color:"orange","font-weight":"bold"}},mt={key:3,style:{color:"green","font-weight":"bold"}},gt={key:4,style:{color:"red","font-weight":"bold"}},bt={key:5,style:{color:"gray","font-weight":"bold"}},kt={key:6},_t={class:"scanner-panel"},wt={key:0},yt={key:1},ft={class:"control-buttons",style:{"margin-top":"1rem","text-align":"center"}},It={key:1,style:{display:"flex",gap:"10px","justify-content":"center"}},St={key:4,class:"confirmation-dialog"},Ct={class:"dialog-content"},Pt={key:5,class:"confirmation-dialog"},vt={class:"dialog-content"},Et={key:6,class:"confirmation-dialog"},Lt={class:"dialog-content"},Tt={key:7,class:"confirmation-dialog"},Nt={class:"dialog-content"},xt={key:8,class:"confirmation-dialog"},At={class:"dialog-content"},Bt={key:9,class:"confirmation-dialog"},Rt={class:"dialog-content"},Ot={style:{display:"flex",gap:"10px","justify-content":"center","margin-top":"1rem"}},Dt={key:10,class:"confirmation-dialog"},Mt={class:"dialog-content"},Xt={style:{display:"flex",gap:"10px","justify-content":"center","margin-top":"1rem"}},Wt={key:11,class:"completion-popup"},$t={class:"popup-content"};function Ft(t,e,s,n,r,i){return(0,a.uX)(),(0,a.CE)("div",m,[r.token?((0,a.uX)(),(0,a.CE)("div",L,[r.batchType||"IDLE"!==r.status.process_state?r.showBatchSelection?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",B,[(0,a.Lk)("h2",R,"Enter Batch Number for "+(0,d.v_)(r.batchType),1),(0,a.Lk)("button",{onClick:e[9]||(e[9]=t=>r.showCancelConfirmation=!0),class:"btn btn-warning",style:{padding:"0.5rem 1rem"}}," Cancel ")]),(0,a.Lk)("div",O,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=t=>r.enteredBatchNumber=t),placeholder:"Type batch number and press Enter or Load",onKeyup:e[11]||(e[11]=(0,o.jR)((...t)=>i.loadBatchByNumber&&i.loadBatchByNumber(...t),["enter"])),ref:"batchInput",style:{flex:"1",padding:"0.6rem","font-size":"1rem"}},null,544),[[o.Jo,r.enteredBatchNumber]]),(0,a.Lk)("button",{onClick:e[12]||(e[12]=(...t)=>i.loadBatchByNumber&&i.loadBatchByNumber(...t)),class:"btn"},"Load")])])):(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",T,[(0,a.Lk)("div",N,[e[37]||(e[37]=(0,a.Lk)("h2",{style:{margin:"0"}},"Select Batch Type",-1)),(0,a.Lk)("button",{onClick:e[6]||(e[6]=(...t)=>i.logout&&i.logout(...t)),class:"btn btn-warning"},"Logout")]),(0,a.Lk)("div",x,[(0,a.Lk)("div",{class:"batch-option",onClick:e[7]||(e[7]=t=>i.selectBatchType("master"))}," MASTER BATCH "),(0,a.Lk)("div",{class:"batch-option",onClick:e[8]||(e[8]=t=>i.selectBatchType("compound"))}," COMPOUND BATCH ")])])),r.showCancelConfirmation?((0,a.uX)(),(0,a.CE)("div",D,[(0,a.Lk)("div",M,[e[38]||(e[38]=(0,a.Lk)("h3",null,"Confirm Cancel",-1)),e[39]||(e[39]=(0,a.Lk)("p",null,"Are you sure you want to cancel batch selection?",-1)),(0,a.Lk)("div",X,[(0,a.Lk)("button",{onClick:e[13]||(e[13]=(...t)=>i.confirmCancelBatchSelection&&i.confirmCancelBatchSelection(...t)),class:"btn btn-warning"},"Yes, Cancel"),(0,a.Lk)("button",{onClick:e[14]||(e[14]=(...t)=>i.cancelCancelBatchSelection&&i.cancelCancelBatchSelection(...t)),class:"btn btn-primary"},"No, Continue")])])])):(0,a.Q3)("",!0),r.workorder&&r.workorder.steps?((0,a.uX)(),(0,a.CE)("div",W,[(0,a.Lk)("div",$,[(0,a.Lk)("h2",F,(0,d.v_)(r.selectedBatch?r.selectedBatch.name:r.workorder.name),1),i.showCancelButton?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e[15]||(e[15]=t=>r.showCancelProcessConfirmation=!0),class:"btn btn-warning",disabled:i.isCancelDisabled,style:{padding:"0.5rem 1rem"}}," Cancel ",8,G)):(0,a.Q3)("",!0)]),r.showCancelProcessConfirmation?((0,a.uX)(),(0,a.CE)("div",j,[(0,a.Lk)("div",U,[e[40]||(e[40]=(0,a.Lk)("h3",null,"Confirm Cancel",-1)),e[41]||(e[41]=(0,a.Lk)("p",null,"Are you sure you want to cancel the process?",-1)),(0,a.Lk)("div",Q,[(0,a.Lk)("button",{onClick:e[16]||(e[16]=(...t)=>i.confirmCancelProcess&&i.confirmCancelProcess(...t)),class:"btn btn-warning"},"Yes, Cancel"),(0,a.Lk)("button",{onClick:e[17]||(e[17]=(...t)=>i.cancelCancelProcess&&i.cancelCancelProcess(...t)),class:"btn btn-primary"},"No, Continue")])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",K,(0,d.v_)(i.getStatusMessage()),1),(0,a.Lk)("table",Y,[e[42]||(e[42]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Stage No."),(0,a.Lk)("th",null,"Item"),(0,a.Lk)("th",null,"Mixing Time"),(0,a.Lk)("th",null,"Prescan"),(0,a.Lk)("th",null,"Live Status")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.status.steps,(t,e)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t.step_id||e},[(0,a.Lk)("tr",{class:(0,d.C4)({"blinking-highlight":i.isNextStep(e)})},[(0,a.Lk)("td",{rowspan:t.items.length},(0,d.v_)(e+1),9,q),(0,a.Lk)("td",null,(0,d.v_)(t.items[0].item_id),1),(0,a.Lk)("td",{rowspan:t.items.length},[r.status.current_step_index!==e||"MIXING"!==r.status.process_state&&"ABORTED"!==r.status.process_state?((0,a.uX)(),(0,a.CE)("span",z,(0,d.v_)(i.formatMixTime(t.mix_time_sec)),1)):((0,a.uX)(),(0,a.CE)("span",J,(0,d.v_)(r.status.mixing_time_remaining)+"s ",1))],8,V),(0,a.Lk)("td",null,["SCANNED"===i.getItemStatus(t.items[0].item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",H," SCANNED ")):"PENDING"===i.getItemStatus(t.items[0].item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",Z," PENDING ")):"DONE"===i.getItemStatus(t.items[0].item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",{key:2,style:(0,d.Tr)({color:"PRESCANNING"===r.status.process_state?"green":"gray",fontWeight:"bold"})}," DONE ",4)):((0,a.uX)(),(0,a.CE)("span",tt,(0,d.v_)(i.getItemStatus(t.items[0].item_id).toUpperCase()),1))]),(0,a.Lk)("td",null,[e===r.status.current_step_index+1&&"SCANNED"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",et," SCANNED ")):"READY_TO_LOAD"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",st," READY TO LOAD ")):"SCANNED"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",ot," SCANNED ")):"MIXING"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",at," MIXING ")):"ABORTED"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",nt," ABORTED ")):"DONE"===t.items[0].live_status?((0,a.uX)(),(0,a.CE)("span",rt," DONE ")):((0,a.uX)(),(0,a.CE)("span",it,(0,d.v_)((t.items[0].live_status||"WAITING").toUpperCase()),1))])],2),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.items.slice(1),t=>((0,a.uX)(),(0,a.CE)("tr",{key:t.item_id,class:(0,d.C4)({"blinking-highlight":i.isNextStep(e)})},[(0,a.Lk)("td",null,(0,d.v_)(t.item_id),1),(0,a.Lk)("td",null,["SCANNED"===i.getItemStatus(t.item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",ct," SCANNED ")):"PENDING"===i.getItemStatus(t.item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",lt," PENDING ")):"DONE"===i.getItemStatus(t.item_id).toUpperCase()?((0,a.uX)(),(0,a.CE)("span",{key:2,style:(0,d.Tr)({color:"PRESCANNING"===r.status.process_state?"green":"gray",fontWeight:"bold"})}," DONE ",4)):((0,a.uX)(),(0,a.CE)("span",ut,(0,d.v_)(i.getItemStatus(t.item_id).toUpperCase()),1))]),(0,a.Lk)("td",null,[e===r.status.current_step_index+1&&"SCANNED"===t.live_status?((0,a.uX)(),(0,a.CE)("span",ht," SCANNED ")):"READY_TO_LOAD"===t.live_status?((0,a.uX)(),(0,a.CE)("span",pt," READY TO LOAD ")):"SCANNED"===t.live_status?((0,a.uX)(),(0,a.CE)("span",dt," SCANNED ")):"MIXING"===t.live_status?((0,a.uX)(),(0,a.CE)("span",mt," MIXING ")):"ABORTED"===t.live_status?((0,a.uX)(),(0,a.CE)("span",gt," ABORTED ")):"DONE"===t.live_status?((0,a.uX)(),(0,a.CE)("span",bt," DONE ")):((0,a.uX)(),(0,a.CE)("span",kt,(0,d.v_)((t.live_status||"WAITING").toUpperCase()),1))])],2))),128))],64))),128))])]),(0,a.Lk)("div",_t,["PRESCANNING"===r.status.process_state?((0,a.uX)(),(0,a.CE)("div",wt,[e[43]||(e[43]=(0,a.Lk)("h3",null,"Scan Item (Prescan)",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e[18]||(e[18]=t=>r.barcode=t),placeholder:"Scan item barcode (prescan)",onKeyup:e[19]||(e[19]=(0,o.jR)((...t)=>i.handlePrescan&&i.handlePrescan(...t),["enter"])),ref:"barcodeInput"},null,544),[[o.Jo,r.barcode]])])):"WAITING_FOR_ITEMS"===r.status.process_state||"MIXING"===r.status.process_state?((0,a.uX)(),(0,a.CE)("div",yt,[e[44]||(e[44]=(0,a.Lk)("h3",null,"Scan Item (Actual)",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e[20]||(e[20]=t=>r.barcode=t),placeholder:"Scan item barcode (actual)",onKeyup:e[21]||(e[21]=(0,o.jR)((...t)=>i.handleScan&&i.handleScan(...t),["enter"])),ref:"barcodeInput"},null,544),[[o.Jo,r.barcode]])])):(0,a.Q3)("",!0),(0,a.Lk)("div",ft,[["MIXING"].includes(r.status.process_state)?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e[22]||(e[22]=(...t)=>i.abortProcess&&i.abortProcess(...t)),class:"btn btn-danger"}," Abort ")):(0,a.Q3)("",!0),"ABORTED"===r.status.process_state?((0,a.uX)(),(0,a.CE)("div",It,[(0,a.Lk)("button",{onClick:e[23]||(e[23]=(...t)=>i.resumeProcess&&i.resumeProcess(...t)),class:"btn btn-success"}," Resume "),(0,a.Lk)("button",{onClick:e[24]||(e[24]=(...t)=>i.completeAbortProcess&&i.completeAbortProcess(...t)),class:"btn btn-warning"}," Stop the process ")])):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0),r.showWrongStagePopup?((0,a.uX)(),(0,a.CE)("div",St,[(0,a.Lk)("div",Ct,[e[45]||(e[45]=(0,a.Lk)("h3",null,"Wrong Stage Item!",-1)),(0,a.Lk)("p",null,(0,d.v_)(r.wrongStageMessage),1),(0,a.Lk)("button",{onClick:e[25]||(e[25]=(...t)=>i.closeWrongStagePopup&&i.closeWrongStagePopup(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0),r.showEarlyScanningWrongItemPopup?((0,a.uX)(),(0,a.CE)("div",Pt,[(0,a.Lk)("div",vt,[e[46]||(e[46]=(0,a.Lk)("h3",null,"Wrong Item for Next Stage!",-1)),(0,a.Lk)("p",null,(0,d.v_)(r.earlyScanningWrongItemMessage),1),(0,a.Lk)("button",{onClick:e[26]||(e[26]=(...t)=>i.closeEarlyScanningWrongItemPopup&&i.closeEarlyScanningWrongItemPopup(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0),r.showDuplicateScanPopup?((0,a.uX)(),(0,a.CE)("div",Et,[(0,a.Lk)("div",Lt,[e[47]||(e[47]=(0,a.Lk)("h3",null,"Duplicate Scanning!",-1)),(0,a.Lk)("p",null,(0,d.v_)(r.duplicateScanMessage),1),(0,a.Lk)("button",{onClick:e[27]||(e[27]=(...t)=>i.closeDuplicateScanPopup&&i.closeDuplicateScanPopup(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0),r.showPrescanCompletePopup?((0,a.uX)(),(0,a.CE)("div",Tt,[(0,a.Lk)("div",Nt,[e[48]||(e[48]=(0,a.Lk)("h3",null,"Pre-scanning Complete!",-1)),e[49]||(e[49]=(0,a.Lk)("p",null,"All items have been scanned successfully.",-1)),(0,a.Lk)("button",{onClick:e[28]||(e[28]=(...t)=>i.confirmPrescan&&i.confirmPrescan(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0),r.showWrongItemPopup?((0,a.uX)(),(0,a.CE)("div",xt,[(0,a.Lk)("div",At,[e[50]||(e[50]=(0,a.Lk)("h3",null,"Wrong Item Scanned!",-1)),(0,a.Lk)("p",null,(0,d.v_)(r.wrongItemMessage),1),(0,a.Lk)("button",{onClick:e[29]||(e[29]=(...t)=>i.closeWrongItemPopup&&i.closeWrongItemPopup(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0),r.showAbortConfirmationPopup?((0,a.uX)(),(0,a.CE)("div",Bt,[(0,a.Lk)("div",Rt,[e[51]||(e[51]=(0,a.Lk)("h3",null,"Confirm Abort",-1)),e[52]||(e[52]=(0,a.Lk)("p",null,"Are you sure you want to abort the process?",-1)),(0,a.Lk)("div",Ot,[(0,a.Lk)("button",{onClick:e[30]||(e[30]=(...t)=>i.confirmAbort&&i.confirmAbort(...t)),class:"btn btn-danger"},"Yes, Abort"),(0,a.Lk)("button",{onClick:e[31]||(e[31]=(...t)=>i.cancelAbort&&i.cancelAbort(...t)),class:"btn btn-primary"},"No, Continue")])])])):(0,a.Q3)("",!0),r.showSavePopup?((0,a.uX)(),(0,a.CE)("div",Dt,[(0,a.Lk)("div",Mt,[e[53]||(e[53]=(0,a.Lk)("h3",null,"Save Workorder",-1)),e[54]||(e[54]=(0,a.Lk)("p",null,"The process is complete. Would you like to save this workorder?",-1)),(0,a.Lk)("div",Xt,[(0,a.Lk)("button",{onClick:e[32]||(e[32]=(...t)=>i.handleSaveWorkorder&&i.handleSaveWorkorder(...t)),class:"btn btn-success"},"SAVE")])])])):(0,a.Q3)("",!0),r.showCompletionPopup?((0,a.uX)(),(0,a.CE)("div",Wt,[(0,a.Lk)("div",$t,[e[55]||(e[55]=(0,a.Lk)("h3",null,"Process Complete!",-1)),(0,a.Lk)("button",{onClick:e[33]||(e[33]=(...t)=>i.handleCompletionOk&&i.handleCompletionOk(...t)),class:"btn btn-primary"},"OK")])])):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",g,[(0,a.Lk)("div",b,[e[36]||(e[36]=(0,a.Lk)("div",{class:"login-header"},[(0,a.Lk)("h1",{class:"login-subtitle"},"Login to start the process")],-1)),(0,a.Lk)("div",k,[(0,a.Lk)("div",_,[e[34]||(e[34]=(0,a.Lk)("label",{for:"username",class:"input-label"}," Username ",-1)),(0,a.bo)((0,a.Lk)("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),type:"text",placeholder:"Enter your username",class:"form-input",onKeyup:e[1]||(e[1]=(0,o.jR)((...t)=>i.login&&i.login(...t),["enter"]))},null,544),[[o.Jo,r.username]])]),(0,a.Lk)("div",w,[e[35]||(e[35]=(0,a.Lk)("label",{for:"password",class:"input-label"}," Password ",-1)),(0,a.Lk)("div",y,[(0,a.bo)((0,a.Lk)("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=t=>r.password=t),type:r.showPassword?"text":"password",placeholder:"Enter your password",class:"form-input password-input",onKeyup:e[3]||(e[3]=(0,o.jR)((...t)=>i.login&&i.login(...t),["enter"]))},null,40,f),[[o.hp,r.password]]),(0,a.Lk)("button",{type:"button",class:"password-toggle",onClick:e[4]||(e[4]=t=>r.showPassword=!r.showPassword)},[r.showPassword?((0,a.uX)(),(0,a.CE)("span",I,"Hide")):((0,a.uX)(),(0,a.CE)("span",S,"Show"))])])]),(0,a.Lk)("div",C,[(0,a.Lk)("button",{onClick:e[5]||(e[5]=(...t)=>i.login&&i.login(...t)),class:(0,d.C4)(["login-button",{"login-button-disabled":!r.username||!r.password}]),disabled:!r.username||!r.password}," Login ",10,P)]),r.error?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("p",E,(0,d.v_)(r.error),1)])):(0,a.Q3)("",!0)])])]))])}var Gt=s(335);const jt="https://shera-undefensible-pseudoindependently.ngrok-free.dev",Ut=Gt.A.create({baseURL:jt,withCredentials:!0,timeout:9e4});Ut.interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t)),Ut.interceptors.response.use(t=>t,t=>(t.response&&401===t.response.status&&(console.warn("Token expired or invalid — logging out"),localStorage.removeItem("token"),window.location.reload()),console.error("API Error:",t),Promise.reject(t)));const Qt=async(t,e)=>{const s=await Ut.post("/api/login",{usr:t,pwd:e});return s.data},Kt=()=>Ut.get("/api/status").then(t=>t.data),Yt=t=>Ut.post("/api/scan",{barcode:t}).then(t=>t.data),qt=()=>Ut.post("/api/abort").then(t=>t.data),Vt=()=>Ut.post("/api/resume").then(t=>t.data),Jt=()=>Ut.post("/api/complete_abort").then(t=>t.data).catch(()=>({status:"error",message:"API call failed"})),zt=()=>Ut.post("/api/cancel").then(t=>t.data).catch(()=>({status:"error",message:"Cancel API call failed"})),Ht=()=>Ut.get("/api/workorders").then(t=>t.data),Zt=()=>Ut.get("/api/check_transitions").then(t=>t.data),te=(t="")=>{const e=t?`/api/batches/${t}`:"/batches";return Ut.get(e).then(t=>t.data)},ee=({batch_no:t})=>Ut.post("/api/find_mixing_sequence",{batch_no:t}).then(t=>t.data).catch(t=>{throw t}),se=()=>Ut.post("/api/confirm_completion").then(t=>t.data).catch(()=>({status:"error",message:"Failed to confirm completion"})),oe=t=>Ut.post("/api/prescan",{barcode:t}).then(t=>t.data),ae=()=>Ut.post("/api/save_workorder").then(t=>t.data).catch(()=>({status:"error",message:"Failed to save workorder"})),ne=()=>Ut.post("/api/confirm_prescan").then(t=>t.data),re={name:"Dashboard",data(){return{username:"",password:"",showPassword:!1,token:localStorage.getItem("token")||null,showLogin:!localStorage.getItem("token"),error:"",kneaderStatus:{},showSavePopup:!1,showCancelConfirmation:!1,showCancelProcessConfirmation:!1,showEarlyScanningWrongItemPopup:!1,earlyScanningWrongItemMessage:"",showAbortConfirmationPopup:!1,batchType:null,showPrescanCompletePopup:!1,showCompletionPopup:!1,showWrongItemPopup:!1,wrongItemMessage:"",showWrongStagePopup:!1,wrongStageMessage:"",showConfirmPopup:!1,batches:[],enteredBatchNumber:"",selectedBatch:null,workorder:null,showBatchSelection:!0,showPrescanning:!1,prescanResults:{},showDuplicateScanPopup:!1,duplicateScanMessage:"",prescanComplete:!1,actualScanning:!1,mixing:!1,mixingTimer:0,mixingInterval:null,scannedItems:[],status:{process_state:"IDLE",lid_open:!0,motor_running:!1,current_step_index:-1,current_item_index:-1,mixing_time_remaining:0,error_message:"",workorder_id:null,total_steps:0},workorders:[],currentWorkorder:null,barcode:"",scanResult:null,debugMode:!1,statusInterval:null,transitionInterval:null,showingCompletion:!1,autoTransitionTimeout:null,hasShownSavePopup:!1,hasShownCompletionPopup:!1}},computed:{scannedItemsCount(){return this.scannedItems.length},currentStepItems(){return this.status.steps&&this.status.current_step_index<this.status.steps.length&&this.status.steps[this.status.current_step_index].items||[]},showCancelButton(){const t=["PRESCANNING","PRESCAN_COMPLETE","IDLE"];return["WAITING_FOR_ITEMS","READY_TO_LOAD"].includes(this.status.process_state)?0===this.status.current_step_index:this.showBatchSelection||t.includes(this.status.process_state)},isCancelDisabled(){if(["PRESCANNING","PRESCAN_COMPLETE","IDLE"].includes(this.status.process_state))return!1;if(["WAITING_FOR_ITEMS","READY_TO_LOAD"].includes(this.status.process_state))return 0!==this.status.current_step_index;const t=["MIXING","ABORTED","WAITING_FOR_LID_CLOSE","WAITING_FOR_MOTOR_START","PROCESS_COMPLETE"];return t.includes(this.status.process_state)},totalItemsCount(){return this.workorder&&this.workorder.steps?this.workorder.steps.reduce((t,e)=>t+(e.items?e.items.length:0),0):0},prescanProgress(){return 0===this.totalItemsCount?0:Math.round(this.scannedItemsCount/this.totalItemsCount*100)},canScan(){return"WAITING_FOR_ITEMS"===this.status.process_state||"PRESCANNING"===this.status.process_state},blinkingStageIndex(){return"MIXING"===this.status.process_state?this.status.current_step_index+1:-1}},async mounted(){if(console.log("Mounted, checking backend state"),this.token=localStorage.getItem("token"),!this.token)return void console.log("No token found, staying on login screen");try{console.log("Testing token validity..."),await Kt(),console.log("Token is valid, proceeding...")}catch(s){if(console.error("Token validation failed:",s),s.message.includes("401")||s.message.includes("Missing Authorization"))return console.log("Token invalid or expired, forcing logout"),void this.logout()}const t=localStorage.getItem("lastBatchType"),e=localStorage.getItem("lastBatchNumber");t&&(this.batchType=t),e&&(this.enteredBatchNumber=e);try{const a=await Kt();function n(t){if(null==t)return null;if("number"===typeof t)return Math.floor(t);const e=String(t).match(/(\d+)/);return e?parseInt(e[1],10):null}if(this.status=a,!this.workorder)if(a.steps?.length)this.workorder={name:a.workorder_name,steps:a.steps};else if(a.sequence_steps?.length){const r=a.sequence_steps.map((t,e)=>({step_id:e+1,mix_time_sec:n(t.mixing_time),items:(t.items||[]).map(t=>({item_id:String(t),name:null,required_weight:null}))}));this.workorder={name:a.workorder_name||`Workorder ${a.batch_no||""}`,steps:r}}this.batchType=a.workorder_type||this.batchType,"IDLE"===a.process_state?this.batchType&&!this.workorder?(this.showBatchSelection=!0,this.showPrescanning=!1):this.workorder?(this.showBatchSelection=!1,this.showPrescanning=!0):(this.showBatchSelection=!1,this.showPrescanning=!1):(this.showBatchSelection=!1,this.showPrescanning=!0)}catch(o){if(console.error("Error checking controller state:",o),o.response&&(401===o.response.status||422===o.response.status))return void this.logout();this.batchType&&(this.showBatchSelection=!0,this.showPrescanning=!1)}try{await this.loadBatches()}catch(o){console.error("Failed to load batches:",o)}try{await this.loadWorkorders()}catch(o){console.error("Failed to load workorders:",o)}this.token&&this.startPolling(),this.$nextTick(()=>{this.showBatchSelection&&this.$refs.batchInput?this.$refs.batchInput.focus():this.showPrescanning&&this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},beforeUnmount(){this.autoTransitionTimeout&&clearTimeout(this.autoTransitionTimeout),this.stopPolling()},watch:{"status.process_state"(t){"PROCESS_COMPLETE"===t?(this.showingCompletion=!0,this.scanResult=null,this.barcode="",setTimeout(()=>{this.showingCompletion=!1},5e3)):"IDLE"===t&&(this.scanResult=null,this.barcode="")},enteredBatchNumber(t){""!==t.trim()&&localStorage.setItem("lastBatchNumber",t.trim())},prescanComplete(t){t&&this.initiateAutoTransition()}},methods:{async login(){this.error="";try{const e=await Qt(this.username,this.password);if(console.log("Login response:",e),e.token){localStorage.setItem("token",e.token),this.token=e.token,console.log("Token stored in localStorage:",localStorage.getItem("token")),console.log("Token length:",e.token.length),this.showBatchSelection=!1,this.batchType=null,this.status={process_state:"IDLE"},this.startPolling();try{await this.updateStatus()}catch(t){console.error("Initial status check failed:",t)}console.log("✅ Login successful — moving to batch type selection"),console.log("Current state - showBatchSelection:",this.showBatchSelection),console.log("Current state - showPrescanning:",this.showPrescanning),console.log("Current state - batchType:",this.batchType)}else this.error="Invalid ERPNext credentials"}catch(t){console.error("Login error:",t),this.error="Login failed. Please check your credentials."}},logout(){console.log("Logging out..."),localStorage.removeItem("token"),localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),this.token=null,this.username="",this.password="",this.error="",this.batchType=null,this.enteredBatchNumber="",this.selectedBatch=null,this.workorder=null,this.showBatchSelection=!1,this.showPrescanning=!1,this.scannedItems=[],this.status={process_state:"IDLE",lid_open:!0,motor_running:!1,current_step_index:-1,current_item_index:-1,mixing_time_remaining:0,error_message:"",workorder_id:null,total_steps:0},this.stopPolling(),console.log("Logout successful - returned to login screen")},showCancelConfirmationPopup(){this.showCancelConfirmation=!0},confirmCancelBatchSelection(){console.log("User confirmed batch selection cancellation"),this.batchType=null,this.enteredBatchNumber="",this.selectedBatch=null,this.workorder=null,this.scannedItems=[],localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),this.showBatchSelection=!1,this.showPrescanning=!1,this.showCancelConfirmation=!1,console.log("Batch selection cancelled - back to batch type selection")},cancelCancelBatchSelection(){console.log("User cancelled the cancellation"),this.showCancelConfirmation=!1,this.$nextTick(()=>{this.$refs.batchInput&&this.$refs.batchInput.focus()})},confirmCancelProcess(){this.showCancelProcessConfirmation=!1,this.cancelProcess()},cancelCancelProcess(){this.showCancelProcessConfirmation=!1,this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},isNextStep(t){return"MIXING"===this.status.process_state&&(t===this.status.current_step_index+1&&(!(t>=this.status.steps.length)&&!this.isStepFullyScanned(t)))},isStepFullyScanned(t){const e=this.status.steps[t];return!(!e||!e.items)&&e.items.every(t=>"SCANNED"===t.live_status)},selectBatchType(t){this.batchType=t,localStorage.setItem("lastBatchType",t),this.showBatchSelection=!0,this.showPrescanning=!1,this.$nextTick(()=>{this.$refs.batchInput&&this.$refs.batchInput.focus()})},async loadBatches(){try{const t=await te();this.batches=t,console.log("Loaded batches:",this.batches)}catch(t){console.error("Failed to load batches:",t)}},closeWrongItemPopup(){this.showWrongItemPopup=!1,this.wrongItemMessage="",this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},getStatusMessage(){if(!this.workorder||!this.workorder.steps)return"";const t=this.status.current_step_index+1,e=t+1;switch(this.status.process_state){case"READY_TO_LOAD":return`Add Stage ${t} items to the kneader`;case"IDLE":return"Prescan";case"PRESCANNING":return"Prescanning in progress";case"PROCESS_COMPLETE":return"✅ Process Complete!";case"WAITING_FOR_ITEMS":return this.isStepReadyToLoad(this.status.current_step_index)?`Load stage - ${t} items`:`Enter the item code for Stage ${t}`;case"MIXING":return this.isStepReadyToLoad(this.status.current_step_index+1)?`Load stage - ${e} items`:this.workorder&&this.status.current_step_index<this.workorder.steps.length-1?`Mixing Stage ${t}, scan Stage ${e} items`:`Mixing Stage ${t}`;case"WAITING_FOR_MOTOR_START":return"Waiting for motor to start";case"ABORTED":return" Process Aborted. Click Resume to continue";default:return""}},getRemainingReadyTime(){return"10"},async loadBatchByNumber(){console.log("loadBatchByNumber called with:",this.enteredBatchNumber);const t=(this.enteredBatchNumber||"").trim();if(t){this.showSavePopup=!1,this.showCompletionPopup=!1,this.hasShownSavePopup=!1,this.hasShownCompletionPopup=!1;try{const s=await ee({batch_no:t});if(console.log("[DEBUG] loadWorkorder response:",s),s&&(s.error||"error"===s.status)){const o=s.error||s.message||"Failed to load batch";return void(this.scanResult={status:"error",message:o})}if(s&&s.workorder){this.scannedItems=[],this.prescanResults={},this.workorder=s.workorder;const a=s.batch_number||t;this.selectedBatch={batch_number:a,name:s.workorder.name||a}}else{if(!s||!s.sequence_steps){const n=s&&(s.message||s.error)?s.message||s.error:"Failed to load workorder";return void(this.scanResult={status:"error",message:n})}{function r(t){if(null==t)return null;if("number"===typeof t)return Math.floor(t);const e=String(t).match(/(\d+)/);return e?parseInt(e[1],10):null}const i=(s.sequence_steps||[]).map((t,e)=>({step_id:e+1,mix_time_sec:r(t.mixing_time),items:(t.items||[]).map(t=>({item_id:String(t),name:null,required_weight:null}))}));this.scannedItems=[],this.prescanResults={},this.workorder={name:s.workorder?.name||`Workorder ${s.batch_no||t}`,steps:i};const c=s.batch_no||t;this.selectedBatch={batch_number:c,name:this.workorder.name||c}}}this.showBatchSelection=!1,this.showPrescanning=!0,this.prescanComplete=!1,localStorage.setItem("lastBatchNumber",this.selectedBatch.batch_number||t),await this.updateStatus(),this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})}catch(e){console.error("Failed to load batch:",e),this.scanResult={status:"error",message:"Failed to load batch"}}}},async completeAbortProcess(){console.log("Complete Abort button clicked");try{const t=await Jt();console.log("Complete Abort API response:",t),t&&"success"===t.status?(console.log("Complete Abort successful, resetting frontend state"),this.status={process_state:"IDLE",lid_open:!0,motor_running:!1,current_step_index:-1,current_item_index:-1,mixing_time_remaining:0,error_message:"",workorder_id:null,total_steps:0},this.batchType=null,localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),this.showBatchSelection=!0,this.showPrescanning=!1,this.workorder=null,this.enteredBatchNumber="",this.scannedItems=[],this.scanResult={status:"success",message:"Process completely aborted and reset to IDLE"}):(console.log("Complete Abort failed:",t),this.scanResult={status:"error",message:t?.message||"Failed to completely abort"})}catch(t){console.error("Complete Abort API call failed:",t),this.scanResult={status:"error",message:"Failed to completely abort process"}}},closeEarlyScanningWrongItemPopup(){this.showEarlyScanningWrongItemPopup=!1,this.earlyScanningWrongItemMessage="",this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},getItemStatus(t){if(this.status.prescan_status&&this.status.prescan_status.status_by_stage)for(let e in this.status.prescan_status.status_by_stage){const s=this.status.prescan_status.status_by_stage[e].items.find(e=>e.item_id===t);if(s)return s.prescan_status.toLowerCase()}return"pending"},getActualItemStatus(t,e){if(e<this.status.current_step_index)return"done";if(e>this.status.current_step_index)return"waiting";if(this.status.scanned_items&&this.status.scanned_items.includes(t))return"done";const s=this.workorder.steps[this.status.current_step_index].items[this.status.current_item_index];return s&&s.item_id===t?"in-progress":"waiting"},getItemStatus(t){if("PRESCANNING"===this.status.process_state){if(this.status.prescan_status&&this.status.prescan_status.status_by_stage)for(let e in this.status.prescan_status.status_by_stage){const s=this.status.prescan_status.status_by_stage[e].items.find(e=>e.item_id===t);if(s)return"scanned"===s.prescan_status.toLowerCase()?"done":s.prescan_status.toLowerCase()}return"pending"}return this.status.prescan_complete||!1===this.showPrescanCompletePopup?"done":"pending"},async handlePrescan(){if(this.barcode.trim())try{const t=await oe(this.barcode.trim());t&&"success"===t.status?(this.prescanResults[this.barcode.trim()]="done",this.scannedItems.includes(this.barcode.trim())||this.scannedItems.push(this.barcode.trim()),this.markPrescanCompleteIfDone(),this.scanResult=t):t&&"error"===t.status?t.message&&t.message.includes("already scanned")?(this.duplicateScanMessage=t.message||"This item has already been scanned.",this.showDuplicateScanPopup=!0,this.scanResult=null):(this.wrongItemMessage=t.message||"This item does not belong to the current workorder.",this.showWrongItemPopup=!0,this.scanResult=null):this.scanResult=t,this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})}catch(t){console.error("Failed to prescan item:",t),this.scanResult={status:"error",message:"Scan failed: "+(t.response?.data?.error||t.message)}}},cancelBatchSelection(){console.log("Cancel batch selection clicked"),this.batchType=null,this.enteredBatchNumber="",this.selectedBatch=null,this.workorder=null,this.scannedItems=[],localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),this.showBatchSelection=!1,console.log("Batch selection cancelled - back to batch type selection")},async cancelProcess(){try{console.log("Cancel button clicked");const t=await zt();"success"===t.status&&"IDLE"===t.data.process_state?(this.status=t.data,this.workorder=null,this.batchType=null,this.enteredBatchNumber="",this.scannedItems=[],this.scanResult={status:"success",message:"Prescan cancelled successfully. System reset to IDLE."},this.showPrescanning=!1,this.showBatchSelection=!0,localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),console.log("UI reset after cancel: back to batch selection")):this.scanResult={status:"error",message:t.message||"Cancel failed"}}catch(t){console.error("Cancel API error:",t),this.scanResult={status:"error",message:"Cancel action failed"}}},initiateAutoTransition(){this.barcode="",this.scanResult={status:"success",message:"Pre-scanning complete! Transitioning to mixing process..."},this.autoTransitionTimeout=setTimeout(()=>{this.confirmPrescan()},2e3)},markPrescanCompleteIfDone(){this.scannedItemsCount===this.totalItemsCount&&(this.showPrescanCompletePopup=!0,this.barcode="")},closeWrongStagePopup(){this.showWrongStagePopup=!1,this.wrongStageMessage="",this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},closeDuplicateScanPopup(){this.showDuplicateScanPopup=!1,this.duplicateScanMessage="",this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()})},startMixing(t){this.mixing=!0,this.mixingTimer=t,this.mixingProgress=0,this.mixingInterval=setInterval(()=>{this.mixingTimer--,this.mixingProgress=Math.floor((t-this.mixingTimer)/t*100),this.mixingTimer<=0&&(clearInterval(this.mixingInterval),this.mixing=!1,this.actualScanning=!0,this.nextStep())},1e3)},nextStep(){this.currentStepIndex++,this.barcode=""},async confirmPrescan(){try{const t=await ne();if(t&&"success"===t.status){this.showPrescanCompletePopup=!1,this.status.prescan_complete=!0,this.barcode="";let t=0;while(t<15){if(await this.updateStatus(),"WAITING_FOR_ITEMS"===this.status.process_state){this.scanResult={status:"success",message:"Prescanning completed. Scan the items for the stage 1 mixing process"};break}await new Promise(t=>setTimeout(t,1e3)),t++}}else{const e=t&&t.message||"Failed to confirm pre-scan";this.scanResult={status:"error",message:e}}}catch(t){console.error("Failed to confirm pre-scan:",t),this.scanResult={status:"error",message:"Failed to confirm pre-scan"}}},formatTime(t){const e=Math.floor(t/60),s=t%60;return`${e}:${s.toString().padStart(2,"0")}`},formatMixTime(t){if(!t&&0!==t)return"—";const e=Math.floor(t/60),s=t%60;return e>0?`${e}m ${s}s`:`${s}s`},async loadWorkorders(){try{const t=await Ht();this.workorders=t.workorders||t,console.log("Loaded workorders:",this.workorders)}catch(t){console.error("Failed to load workorders:",t)}},updateUIState(){switch(this.status.process_state){case"MIXING":this.$nextTick(()=>console.log("Mixing state active"));break;case"WAITING_FOR_ITEMS":this.$nextTick(()=>{this.$refs.actualBarcodeInput&&this.$refs.actualBarcodeInput.focus(),console.log("Waiting for items, focusing scanner")});break;case"PRESCANNING":this.showPrescanning=!0,this.updatePrescanProgress(),this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()});break;default:}},async checkAndTriggerTransitions(){try{if("WAITING_FOR_LID_CLOSE"===this.status.process_state||"WAITING_FOR_MOTOR_START"===this.status.process_state){const t=await Zt();t&&"success"===t.status&&await this.updateStatus()}}catch(t){console.error("Transition check failed:",t)}},async updateStatus(){try{const t=await Kt();if(this.status=t,"PRESCAN_COMPLETE"!==t.process_state||this.showPrescanCompletePopup||(this.showPrescanCompletePopup=!0),"WAITING_FOR_ITEMS"===t.process_state&&this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()}),this.showPrescanning&&"WAITING_FOR_ITEMS"===t.process_state&&(this.showPrescanning=!0),t.just_completed||"PROCESS_COMPLETE"===t.process_state){const e=t.current_step_index>=t.total_steps-1,s=t.steps&&t.steps.every(t=>t.items.every(t=>"DONE"===t.live_status));!this.hasShownSavePopup&&e&&s&&(console.log("Process complete detected -> showing SAVE popup (once per batch)"),this.showSavePopup=!0,this.hasShownSavePopup=!0)}}catch(t){console.error("Failed to update status:",t),this.status={...this.status,error_message:"Failed to update status"}}},shouldBlink(t){return t===this.blinkingStageIndex},getStepStatus(t){if("PRESCANNING"===this.status.process_state){if(this.status.prescan_status&&this.status.prescan_status.status_by_stage){const e=this.status.prescan_status.status_by_stage[t+1];if(e&&e.live_status)return e.live_status.toLowerCase()}return"waiting"}return"WAITING_FOR_ITEMS"===this.status.process_state?t<this.status.current_step_index?"done":t===this.status.current_step_index?"in-progress":"waiting":"MIXING"===this.status.process_state?t===this.status.current_step_index?"mixing":t<this.status.current_step_index?"done":"waiting":"PROCESS_COMPLETE"===this.status.process_state?"done":"waiting"},isStepReadyToLoad(t){if(t<0||t>=this.status.steps.length||!this.status.steps)return!1;const e=this.status.steps[t];return!(!e||!e.items||0===e.items.length)&&e.items.every(t=>"READY_TO_LOAD"===t.live_status)},startPolling(){this.statusInterval=setInterval(this.updateStatus,1e3),this.transitionInterval=setInterval(this.checkAndTriggerTransitions,2e3)},stopPolling(){this.statusInterval&&(clearInterval(this.statusInterval),this.statusInterval=null),this.transitionInterval&&(clearInterval(this.transitionInterval),this.transitionInterval=null)},async handleScan(){if(this.barcode.trim()){console.log("Sending scan:",this.barcode.trim());try{const t=await Yt(this.barcode.trim());if(t.error)this.scanResult={status:"error",message:"Scan failed: "+t.error};else if("fail"===t.status)if(t.message&&(t.message.includes("does not belong to this stage")||t.message.includes("does not belong to this or next step"))){if("MIXING"===this.status.process_state){const t=this.status.current_step_index+2;this.earlyScanningWrongItemMessage=`This item does not belong to Stage ${t}. Please scan the correct item for the next stage.`,this.showEarlyScanningWrongItemPopup=!0}else this.wrongStageMessage="Item does not belong to this stage",this.showWrongStagePopup=!0;this.scanResult=null,this.barcode=""}else this.scanResult={status:"error",message:t.message};else{const e=this.status.current_step_index,s="MIXING"===this.status.process_state;let o=s?[e+1]:[e];const a=o.flatMap(t=>this.workorder.steps[t]?.items.map(t=>t.item_id)||[]);if(!a.includes(this.barcode.trim())){if(s){const t=this.status.current_step_index+2;this.earlyScanningWrongItemMessage=`Invalid item for Stage ${t}`,this.showEarlyScanningWrongItemPopup=!0}else this.wrongStageMessage="Invalid item for this stage",this.showWrongStagePopup=!0;return this.scanResult=null,void(this.barcode="")}this.scanResult=t,"success"===t.status&&(this.barcode="",this.$nextTick(()=>{this.$refs.barcodeInput&&this.$refs.barcodeInput.focus()}),await this.updateStatus())}}catch(t){console.error("Failed to scan item:",t),this.scanResult={status:"error",message:"Scan failed: "+(t.response?.data?.error||t.message)}}}},async abortProcess(){this.showAbortConfirmationPopup=!0},async confirmAbort(){try{this.showAbortConfirmationPopup=!1,await qt(),this.scanResult={status:"success",message:"Process aborted successfully"}}catch(t){console.error("Failed to abort process:",t),this.scanResult={status:"error",message:"Failed to abort process"}}},cancelAbort(){this.showAbortConfirmationPopup=!1,this.scanResult={status:"info",message:"Abort cancelled - process continues"}},async resumeProcess(){try{await Vt()}catch(t){console.error("Failed to resume process:",t)}},async handleSaveWorkorder(){try{const t=await ae();"success"===t.status?(console.log("Workorder saved successfully:",t.message),this.scanResult={status:"success",message:"Workorder saved successfully!"},this.showSavePopup=!1,this.showCompletionPopup=!0,this.hasShownCompletionPopup=!0):(console.warn("Failed to save workorder:",t.message),this.scanResult={status:"error",message:t.message||"Failed to save workorder"})}catch(t){console.error("Save workorder API failed:",t),this.scanResult={status:"error",message:"Error saving workorder"}}},confirmProcessComplete(){this.showProcessCompletePopup=!1,this.status.process_state="IDLE",this.showBatchSelection=!0,this.showPrescanning=!1,this.workorder=null,this.enteredBatchNumber=""},pollStatus(){this.interval=setInterval(()=>{Kt().then(t=>{console.log("Polled status:",t),this.status=t,this.updateUIState()}).catch(t=>console.error("Polling error:",t))},1e3)},async handleCompletionOk(){try{const t=await se();"success"===t.status?(this.showCompletionPopup=!1,this.status={process_state:"IDLE"},this.batchType=null,localStorage.removeItem("lastBatchType"),localStorage.removeItem("lastBatchNumber"),this.showBatchSelection=!0,this.showPrescanning=!1,this.workorder=null,this.enteredBatchNumber="",this.hasShownSavePopup=!1,this.hasShownCompletionPopup=!1):console.error("Completion confirm failed:",t.message)}catch(t){console.error("Failed to reset process after completion:",t)}}}},ie=(0,l.A)(re,[["render",Ft],["__scopeId","data-v-42210c66"]]),ce=ie,le=[{path:"/",name:"Dashboard",component:ce}],ue=(0,p.aE)({history:(0,p.Bt)(),routes:le}),he=ue;(0,o.Ef)(h).use(he).mount("#app")}},e={};function s(o){var a=e[o];if(void 0!==a)return a.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,s),n.exports}s.m=t,(()=>{var t=[];s.O=(e,o,a,n)=>{if(!o){var r=1/0;for(u=0;u<t.length;u++){for(var[o,a,n]=t[u],i=!0,c=0;c<o.length;c++)(!1&n||r>=n)&&Object.keys(s.O).every(t=>s.O[t](o[c]))?o.splice(c--,1):(i=!1,n<r&&(r=n));if(i){t.splice(u--,1);var l=a();void 0!==l&&(e=l)}}return e}n=n||0;for(var u=t.length;u>0&&t[u-1][2]>n;u--)t[u]=t[u-1];t[u]=[o,a,n]}})(),(()=>{s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{s.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{s.p=""})(),(()=>{var t={524:0};s.O.j=e=>0===t[e];var e=(e,o)=>{var a,n,[r,i,c]=o,l=0;if(r.some(e=>0!==t[e])){for(a in i)s.o(i,a)&&(s.m[a]=i[a]);if(c)var u=c(s)}for(e&&e(o);l<r.length;l++)n=r[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(u)},o=self["webpackChunkkneader_ui"]=self["webpackChunkkneader_ui"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var o=s.O(void 0,[504],()=>s(772));o=s.O(o)})();
//# sourceMappingURL=app.js.map